<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Form</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <script src="https://unpkg.com/htmx.org@1.6.1"></script>
</head>

<body class="bg-gray-100">
    <h1 class="text-2xl font-bold text-center mt-4">Registration Form</h1>
    <div class="container mx-auto p-4">
        <form class="bg-white p-6 rounded-lg shadow-md max-w-lg mx-auto">
            <!-- Personal Information -->
            <div>
                <label class="block text-sm font-medium">Date of Birth</label>
                <input type="date" name="birthdate" required class="w-full px-3 py-2 border rounded-md">
            </div>
            <div>
                <label class="block text-sm font-medium">Gender</label>
                <select name="gender" required class="w-full px-3 py-2 border rounded-md">
                    <option value="">-- Choose --</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="non-binary">Non-binary</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium">Preferred Gender(s)</label>
                <select name="preferred_gender" required class="w-full px-3 py-2 border rounded-md">
                    <option value="">-- Choose --</option>
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="non-binary">Non-binary</option>
                    <option value="all">All</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium">Sexual Orientation</label>
                <select name="sexual_orientation" required class="w-full px-3 py-2 border rounded-md">
                    <option value="">-- Choose --</option>
                    <option value="heterosexual">Heterosexual</option>
                    <option value="homosexual">Homosexual</option>
                    <option value="bisexual">Bisexual</option>
                    <option value="pansexual">Pansexual</option>
                    <option value="asexual">Asexual</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium">Relationship Status</label>
                <select name="relationship_status" required class="w-full px-3 py-2 border rounded-md">
                    <option value="">-- Choose --</option>
                    <option value="single">Single</option>
                    <option value="open relationship">Open Relationship</option>
                </select>
            </div>

            <!-- Profile and Appearance -->
            <div>
                <label class="block text-sm font-medium">Physical Appearance</label>
                <select name="physical_appearance" required class="w-full px-3 py-2 border rounded-md">
                    <option value="">-- Choose --</option>
                    <option value="thin">Thin</option>
                    <option value="normal">Normal</option>
                    <option value="fat">Fat</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium">Size</label>
                <select name="size" required class="w-full px-3 py-2 border rounded-md">
                    <option value="">-- Choose --</option>
                    <option value="small">Small</option>
                    <option value="normal">Normal</option>
                    <option value="large">Large</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium">Weight</label>
                <select name="weight" required class="w-full px-3 py-2 border rounded-md">
                    <option value="">-- Choose --</option>
                    <option value="small">Small</option>
                    <option value="normal">Normal</option>
                    <option value="large">Large</option>
                </select>
            </div>

            <!-- Interests and Lifestyle -->
            <div>
                <label class="block text-sm font-medium">Hobbies and Passions</label>
                <input type="text" name="hobbies" class="w-full px-3 py-2 border rounded-md">
            </div>

            <!-- Location and Search Preferences -->
            <div>
                <label class="block text-sm font-medium">City / Region</label>
                <input type="text" name="location" required class="w-full px-3 py-2 border rounded-md">
            </div>
            <div>
                <label class="block text-sm font-medium">Maximum Search Distance (Km)</label>
                <input type="number" name="search_distance" required class="w-full px-3 py-2 border rounded-md">
            </div>
            <div>
                <label class="block text-sm font-medium">Preferred Age Range</label>
                <input type="text" name="age_range" required class="w-full px-3 py-2 border rounded-md">
            </div>

            <div>
                <label class="block text-sm font-medium">Profile Photo(s)</label>
                <input type="file" name="profile_photos" required class="w-full px-3 py-2 border rounded-md">
            </div>
            <div>
                <label class="block text-sm font-medium">Bio</label>
                <textarea name="bio" required class="w-full px-3 py-2 border rounded-md"></textarea>
            </div>
            <!-- Terms and Validation -->
            <div>
                <label class="block text-sm font-medium">Accept Terms and Conditions</label>
                <input type="checkbox" name="terms" required class="mr-2"> I accept the Terms and Conditions and Privacy
                Policy
            </div>
            <div>
                <label class="block text-sm font-medium">Consent to Notifications and Promotional Emails</label>
                <input type="checkbox" name="notifications" class="mr-2"> I consent to receive notifications and
                promotional emails
            </div>

            <button type="submit" onclick="validate()"
                class="w-full bg-pink-600 text-white py-2 rounded-md hover:bg-pink-700">
                Validate
            </button>
        </form>

        <div id="response" class="mt-4 text-center text-sm text-gray-600"></div>
    </div>
</body>

</html>

<script>
    function validate() {
        const form = document.getElementById('registrationForm');
        const formData = new FormData(form);
        const jsonData = {};
        let isValid = true;

        // Convert FormData to JSON mais ignore checkboxes et le boutton de soumission
        for (const [key, value] of formData.entries()) {
            if (value !== 'on' && key !== 'submit') {
                jsonData[key] = value;
            }
            if (value === 'off' && key === 'terms') {
                isValid = false;
            }
        }

        if (!isValid) {
            document.getElementById('response').innerText = 'Please accept the Terms and Conditions';
            return;
        }
        fetch('/update', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(jsonData)
        })
            .then(response => response.json())
            .then(data => {
                document.getElementById('response').innerText = JSON.stringify(data);
            })
            .catch(error => console.error('Error:', error));
    }
</script>